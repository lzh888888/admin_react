import React, { PureComponent, Fragment } from 'react';
import { connect } from 'dva';
import { Spin, Table, Card, Divider } from 'antd';

import PageHeaderLayout from '../../../layouts/PageHeaderLayout';

// import Add from './Add';
// import Edit from './Edit';
import Detail from './Detail';

import styles from './index.less';

@connect(({
  user,
  renew,
  loading,
}) => ({
  user,
  renew,
  getLoading: !!loading.effects['renew/get'],
  delLoading: !!loading.effects['renew/del'],
}))
export default class extends PureComponent {
  constructor(props) {
    super(props);
    this.columns = [{
      title: '日期',
      dataIndex: 'billdate',
      width: 180,
    }, {
      title: '原价',
      dataIndex: 'prime',
      width: 180,
    }, {
      title: '单价',
      dataIndex: 'price',
      width: 180,
    }, {
      title: '合计',
      dataIndex: 'amount',
      width: 180,
    }, {
      title: '许可数量',
      dataIndex: 'license',
      width: 180,
    }, {
      title: '续费时长',
      dataIndex: 'qty',
      width: 180,
      // }, {
      //   title: '生效日期',
      //   dataIndex: 'avabledate',
      //   width: 180,
      // }, {
      //   title: '结束日期',
      //   dataIndex: 'overdate',
      //   width: 180,
    }, {
      title: '是否有开发票',
      dataIndex: 'invoice',
      width: 180,
      render: value => {
        if (value === '0') {
          return (
            <span>是</span>
          );
        } else {
          return false;
        }
      },
    }, {
      title: '支付备注',
      dataIndex: 'remark',
      width: 180,
    }, {
      title: '支付状态',
      dataIndex: 'isok',
      width: 180,
      render: value => {
        if (value === '1') {
          return (
            <span>已支付</span>
          );
        } else if (value === '2') {
          return (
            <span>未支付</span>
          );
        }
      },
    }, {
      title: '操作',
      key: 'action',
      fixed: 'right',
      width: 130,
      render: text => (
        <Fragment>
          <a onClick={() => this.gotoDetail(text)}>详细</a>
          <Divider type="vertical" />
          <span>{this.onAction()}</span>
          {/* <Popconfirm title="确定删除？" onConfirm={() => this.onAction(text, '删除')}>
            <a>续费</a>
          </Popconfirm> */}
          {/* <Dropdown
            overlay={
              <Menu>
                <Menu.Item>
                  <a onClick={() => this.onAction(text, '编辑')}>编辑</a>
                </Menu.Item>
                <Menu.Item>
                  <Popconfirm title="确定删除？" onConfirm={() => this.onAction(text, '删除')}>
                    <a>删除</a>
                  </Popconfirm>
                </Menu.Item>
              </Menu>
            }
          >
            <a>更多 <Icon type="down" /></a>
          </Dropdown> */}
        </Fragment>
      ),
    }];
  }

  componentDidMount() {
    this.getList();
  }

  componentWillUnmount() {
    this.props.dispatch({ type: 'renew/_clear' });
  }

  // 查询
  onSearch(value) {
    this.changeReqParams({
      page: 1,
      keyword: value,
    });
  }

  // 处理
  onAction = (value) => {
    // const { phoneno } = this.props.user.currentUser;
    if (value === '1') {
      return (
        <a>续费</a>
      )
    } else {
      return (
        <span>续费</span>
      )
    }
  }

  // onAction = (item, type) => {
  //   const { phoneno } = this.props.user.currentUser;
  //   if (type === '编辑') {
  //     this.props.dispatch({
  //       type: 'renew/_showModal',
  //       payload: { type: 'Edit', item },
  //     });
  //   } else if (type === '删除') {
  //     this.props.dispatch({
  //       type: 'renew/del',
  //       payload: {
  //         uid: phoneno,
  //         billno: item.billno,
  //       },
  //     });
  //   }
  // }

  // 页数切换
  onPageSwitch = (pagination) => {
    this.changeReqParams({
      page: pagination.current,
    });
  }

  // 获取数据
  getList = () => {
    this.props.dispatch({ type: 'renew/get' });
  }


  // 修改所需的请求参数后再获取数据
  changeReqParams = (params) => {
    this.props.dispatch({
      type: 'renew/_changeReqParams',
      payload: params,
    });
    this.getList();
  }

  // 查看详情
  gotoDetail = (text) => {
    this.props.dispatch({
      type: 'renew/_showModal',
      payload: { type: 'Detail', item: text },
    });
  }

  // 添加
  gotoAdd = () => {
    this.props.dispatch({
      type: 'renew/_showModal',
      payload: { type: 'Add', item: {} },
    });
  }

  // 打印
  // gotoPrinter = () => {
  //   this.props.dispatch({
  //     type: 'renew/_showModal',
  //     payload: { type: 'Printer', item: {} },
  //   });
  // }

  render() {
    const {
      renew: { listData, reqParams },
      getLoading,
      delLoading,
    } = this.props;
    return (
      <PageHeaderLayout>
        <div className={styles.tableList}>
          <Spin spinning={getLoading || delLoading}>
            <Card
              className={styles.listCard}
              bordered={false}
            >
              <div className={styles.tableListOperator}>
                {/* <Button icon="plus" type="primary" onClick={this.gotoAdd}>
                  新增续费记录
                </Button> */}
              </div>
              <Table
                // className={styles.table}
                // scroll={{ x: 1250, y: 350 }}
                rowKey="id"
                columns={this.columns}
                dataSource={listData.list}
                onChange={this.onPageSwitch}
                pagination={{
                  current: reqParams.page,
                  defaultCurrent: 1,
                  defaultPageSize: 15,
                  total: listData.total,
                }}
              />
            </Card>
          </Spin>
        </div>
        {/* <Add /> */}
        {/* <Edit /> */}
        <Detail />
      </PageHeaderLayout>
    );
  }
}
